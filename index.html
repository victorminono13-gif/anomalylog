<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARQUIVO RESTRITO — CONSULTA DE ENTIDADES</title>

<link href="https://fonts.googleapis.com/css2?family=VT323&family=Courier+Prime&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0b0b;
  --paper:#141414;
  --ink:#e8e8e8;
  --danger:#b30000;
  --glitch:#00ffcc;
  --file-color:#0099ff;
  --file-bg:rgba(0, 153, 255, 0.08);
}

/* ESTILOS DA TELA DE CARREGAMENTO */
#loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: 'Courier Prime', monospace;
  overflow: hidden;
}

.console-container {
  width: 90%;
  max-width: 800px;
  background: rgba(10, 10, 10, 0.95);
  border: 1px solid #222;
  padding: 20px;
  position: relative;
  box-shadow: 0 0 30px rgba(0, 255, 204, 0.1);
}

.console-header {
  border-bottom: 1px solid #333;
  padding-bottom: 10px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.console-title {
  color: var(--glitch);
  font-family: 'VT323', monospace;
  font-size: 1.5em;
  letter-spacing: 2px;
}

.console-time {
  color: #777;
  font-size: 0.8em;
}

.console-content {
  min-height: 300px;
  overflow-y: auto;
  padding: 10px;
  border: 1px solid #222;
  background: rgba(5, 5, 5, 0.8);
}

.console-line {
  margin: 8px 0;
  color: #e8e8e8;
  font-size: 0.9em;
  line-height: 1.4;
  white-space: pre-wrap;
}

.console-line.prompt { color: var(--glitch); }
.console-line.system { color: #00aaff; }
.console-line.warning { color: #ff9900; }
.console-line.error { color: #ff3333; }
.console-line.success { color: #00cc66; }

.blinking-cursor {
  display: inline-block;
  width: 8px;
  height: 16px;
  background: var(--glitch);
  margin-left: 5px;
  animation: blink 1s infinite;
  vertical-align: middle;
}

@keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }

.loading-logo {
  margin-bottom: 30px;
  text-align: center;
}

.logo-text {
  font-family: 'VT323', monospace;
  font-size: 2.2em;
  color: var(--glitch);
  text-transform: uppercase;
  letter-spacing: 3px;
  margin-bottom: 10px;
  position: relative;
  display: inline-block;
}

.loading-bar-container {
  width: 90%;
  max-width: 600px;
  margin-top: 40px;
  background: #111;
  border: 1px solid #333;
  padding: 15px;
}

.loading-bar {
  width: 100%;
  height: 20px;
  background: #050505;
  border: 1px solid #333;
  position: relative;
  overflow: hidden;
}

.loading-progress {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: linear-gradient(90deg, #002233, #00aaff, #002233);
  background-size: 200% 100%;
  animation: loadingGradient 2s linear infinite;
  width: 0%;
  transition: width 0.3s ease;
}

@keyframes loadingGradient { 0% { background-position: 200% 0; } 100% { background-position: 0% 0; } }

.loading-percentage {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: bold;
  font-size: 0.8em;
  text-shadow: 0 0 5px #000;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:20px;
  background:var(--bg);
  color:var(--ink);
  font-family:'Courier Prime',monospace;
  position:relative;
  overflow-x:hidden;
  opacity: 0;
}

/* Efeito de glitch na página inteira */
.glitch-overlay{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:1000;
  opacity:0;
  background:linear-gradient(rgba(0,255,204,0.03), transparent 30%),
            linear-gradient(90deg, rgba(255,0,0,0.02), rgba(0,255,204,0.02));
  mix-blend-mode:screen;
}

body.glitch-active .glitch-overlay{ animation:fullGlitch 0.5s infinite; }

@keyframes fullGlitch{
  0%{ opacity:0.1; transform:translateX(0); clip-path:inset(0 0 0 0); }
  10%{ opacity:0.3; transform:translateX(-2px); clip-path:inset(20% 0 60% 0); }
  20%{ opacity:0.1; transform:translateX(2px); clip-path:inset(60% 0 20% 0); }
  100%{ opacity:0.1; transform:translateX(0); clip-path:inset(0 0 0 0); }
}

body.tremor-1{animation:tremor .6s infinite}
body.tremor-2{animation:tremor .35s infinite}

@keyframes tremor{
  0%{transform:translate(0,0)}
  25%{transform:translate(1px,-1px)}
  50%{transform:translate(-1px,1px)}
  75%{transform:translate(1px,1px)}
  100%{transform:translate(0,0)}
}

.container{
  max-width:1200px;
  margin:auto;
  display:grid;
  grid-template-columns:1fr 2fr;
  gap:30px;
  position:relative;
  z-index:1;
}

.paper{
  background:var(--paper);
  border:1px solid #2a2a2a;
  padding:20px;
  box-shadow:0 0 15px rgba(0,0,0,.6);
}

h1,h2,h3{
  font-family:'VT323',monospace;
  color:var(--danger);
  text-transform:uppercase;
  margin-top:0;
}

label{font-size:.85em;color:#aaa;display:block;margin-bottom:5px;}

input,textarea,select,button{
  background:#050505;
  border:1px solid #333;
  color:var(--ink);
  padding:8px;
  font-family:'Courier Prime',monospace;
}

button{ cursor:pointer; transition:0.3s; }
button:hover{ background:#222; }

.anomaly-list {
  max-height:300px;
  overflow-y:auto;
  border:1px solid #333;
  background:#0a0a0a;
}

.anomaly-item {
  padding:10px;
  border-bottom:1px solid #222;
  cursor:pointer;
}

.anomaly-item:hover { background:#1a1a1a; }
.anomaly-item.active { border-left:3px solid var(--glitch); background:#111; }

.anomaly-id { font-weight:bold; color:var(--glitch); }

.warning{
  border:1px solid var(--danger);
  padding:10px;
  color:var(--danger);
  font-size:.75em;
  margin-top:10px;
  text-align:center;
}

img{
  max-width:100%;
  filter:brightness(0.7) contrast(1.2);
  border:1px solid #333;
}

body.bio img{
  animation:imageGlitch .25s infinite;
  transform:scale(1.05);
}

@keyframes imageGlitch{
  0%{ clip-path:inset(10% 0 20% 0); filter:hue-rotate(90deg); }
  50%{ clip-path:inset(20% 0 10% 0); filter:invert(1); }
  100%{ clip-path:inset(0 0 0 0); }
}

.scanlines{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:linear-gradient(rgba(18,16,16,0) 50%,rgba(0,0,0,0.1) 50%),linear-gradient(90deg,rgba(255,0,0,0.03),rgba(0,255,0,0.01),rgba(0,0,255,0.03));
  background-size:100% 4px, 3px 100%;
  pointer-events:none;
  z-index:999;
}

/* Novo Estilo para Botões do GitHub */
.github-controls {
  margin-top: 15px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}

#btnExport {
  background: rgba(0, 255, 204, 0.1);
  color: var(--glitch);
  border: 1px solid var(--glitch);
}
</style>
</head>

<body>
<div id="loading-screen">
  <div class="loading-logo"><div class="logo-text">SISTEMA C.C.O INICIALIZANDO...</div></div>
  <div class="console-container">
    <div class="console-header"><div class="console-title">TERMINAL DE ACESSO</div><div id="console-time"></div></div>
    <div class="console-content" id="console-content"></div>
  </div>
  <div class="loading-bar-container">
    <div class="loading-bar"><div class="loading-progress" id="loading-progress"></div><div class="loading-percentage" id="loading-percentage">0%</div></div>
  </div>
</div>

<div class="scanlines"></div>
<div class="glitch-overlay"></div>

<div class="container">
  <div class="paper sidebar">
    <h1>CONSULTA</h1>
    <label>PESQUISAR ID</label>
    <input type="text" id="searchInput" placeholder="Digite o ID..." style="width:100%; margin-bottom:10px;">
    
    <label>LISTA DE REGISTROS</label>
    <div class="anomaly-list" id="anomalyList"></div>
    
    <div class="github-controls">
      <button id="btnExport">EXPORTAR PARA GITHUB</button>
      <label style="margin-top:10px">IMPORTAR LOCAL</label>
      <input type="file" id="jsonInput" accept="application/json">
    </div>

    <div class="warning">CUIDADO: ARQUIVOS COM RASTREAMENTO ATIVO.</div>
  </div>

  <div class="paper">
    <div id="dossierContent">
      <h2>DOSSIÊ CONFIDENCIAL</h2>
      <p style="color:#777">Selecione uma entidade para descriptografar os dados.</p>
    </div>
  </div>
</div>

<script>
// --- CONFIGURAÇÃO E LÓGICA DO SISTEMA ---
let saved = JSON.parse(localStorage.getItem('analog_entities') || '[]');
let currentAnomalyIndex = -1;
const el = id => document.getElementById(id);

// 1. CARREGAR DO GITHUB (DATABASE.JSON)
async function syncWithGithub() {
  try {
    // Tenta ler o arquivo database.json do repositório
    const response = await fetch('database.json');
    if (response.ok) {
      const data = await response.json();
      if (data.anomalies) {
        // Mesclar dados (prioriza o que está no servidor)
        const map = new Map();
        saved.forEach(a => map.set(a.id, a));
        data.anomalies.forEach(a => map.set(a.id, a));
        saved = Array.from(map.values());
        localStorage.setItem('analog_entities', JSON.stringify(saved));
        updateList();
        console.log("Sincronizado com database.json");
      }
    }
  } catch (e) { console.warn("database.json não encontrado no repositório."); }
}

// 2. EXPORTAR PARA ATUALIZAR O REPOSITÓRIO
el('btnExport').onclick = () => {
  const data = { anomalies: saved, lastUpdate: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'database.json';
  a.click();
  alert("Arquivo baixado. Agora faça o upload deste 'database.json' para o seu GitHub para atualizar o site.");
};

// 3. INTERFACE E LISTA
function updateList(filter = '') {
  const list = el('anomalyList');
  list.innerHTML = '';
  const filtered = saved.filter(a => a.id.toLowerCase().includes(filter.toLowerCase()));
  
  filtered.forEach((a, i) => {
    const item = document.createElement('div');
    item.className = 'anomaly-item';
    item.innerHTML = `<div class="anomaly-id">${a.id}</div><small>${a.threat || 'Nível Desconhecido'}</small>`;
    item.onclick = () => loadAnomaly(saved.indexOf(a));
    list.appendChild(item);
  });
}

function loadAnomaly(index) {
  currentAnomalyIndex = index;
  const a = saved[index];
  const content = el('dossierContent');
  
  // Limpar efeitos
  document.body.className = '';
  if(a.severity === 'fatal') document.body.classList.add('tremor-2');
  if(a.severity === 'biologico') document.body.classList.add('bio');

  content.innerHTML = `
    <h2>${a.id}</h2>
    ${a.image ? `<img src="${a.image}">` : ''}
    <div style="margin-top:15px; border-top:1px solid #333; padding-top:15px;">
      <p><strong>CLASSIFICAÇÃO:</strong> ${a.threat || '???'}</p>
      <p><strong>ESTADO:</strong> ${a.severity || 'Estável'}</p>
      <p><strong>RELATO:</strong><br>${a.visual || 'Sem descrição visual.'}</p>
      <p><strong>COMPORTAMENTO:</strong><br>${a.behavior || 'Não documentado.'}</p>
    </div>
  `;
}

// 4. IMPORTAÇÃO DE ARQUIVO
el('jsonInput').onchange = (e) => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const data = JSON.parse(ev.target.result);
      const newAnomalies = data.anomalies || [data];
      saved = [...saved, ...newAnomalies.filter(n => !saved.find(s => s.id === n.id))];
      localStorage.setItem('analog_entities', JSON.stringify(saved));
      updateList();
      alert("Dados carregados com sucesso!");
    } catch(err) { alert("Erro ao ler JSON."); }
  };
  reader.readAsText(file);
};

el('searchInput').oninput = (e) => updateList(e.target.value);

// 5. TELA DE CARREGAMENTO (SIMULADA)
function startLoading() {
  const consoleEl = el('console-content');
  const messages = [
    "> Acessando rede C.C.O...",
    "> Verificando database.json...",
    "[OK] Conexão segura estabelecida.",
    "> Sincronizando registros..."
  ];
  
  let i = 0;
  const interval = setInterval(() => {
    if(i < messages.length) {
      const p = document.createElement('div');
      p.className = 'console-line success';
      p.textContent = messages[i];
      consoleEl.appendChild(p);
      el('loading-progress').style.width = ((i+1) * 25) + '%';
      el('loading-percentage').textContent = ((i+1) * 25) + '%';
      i++;
    } else {
      clearInterval(interval);
      setTimeout(() => {
        el('loading-screen').style.display = 'none';
        document.body.style.opacity = '1';
        syncWithGithub();
        updateList();
      }, 1000);
    }
  }, 600);
}

window.onload = startLoading;
</script>
</body>
</html>
